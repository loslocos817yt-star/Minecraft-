<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffi's store</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #e8eaed;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background-color: #121212;
            z-index: 10;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo span { color: #01875f; font-size: 1.6rem; }

        /* AVATAR */
        .user-avatar {
            width: 35px; height: 35px;
            background: linear-gradient(135deg, #34a853, #188038, #01875f, #1e1e1e);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; cursor: pointer; border: 2px solid #fff;
            font-size: 14px;
        }

        /* MODALES */
        .modal-cuenta {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #1e1e1e; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center;
            border: 1px solid #333; position: relative;
        }
        .modal-content input {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #333; background: #2d2d2d; color: #fff; outline: none;
        }

        /* BOTONES */
        .btn-install {
            display: block; width: 100%; background-color: #01875f; color: white; text-align: center;
            padding: 12px; border-radius: 25px; text-decoration: none; font-weight: 700; font-size: 0.95rem;
            border: none; cursor: pointer; margin-top: 10px;
        }

        /* BOTÃ“N CERRAR SESIÃ“N ROJO */
        .btn-logout {
            background-color: #d93025; /* Rojo Google */
            margin-top: 20px;
        }

        /* DISEÃ‘O INFO PERFIL */
        .perfil-info { margin: 15px 0; text-align: left; background: #2d2d2d; padding: 15px; border-radius: 10px; }
        .perfil-info p { margin: 5px 0; font-size: 0.9rem; color: #aaa; }
        .perfil-info span { color: #fff; font-weight: bold; display: block; font-size: 1.1rem; }

        .btn-cerrar-modal {
            position: absolute; top: 10px; right: 15px; font-size: 20px; color: #aaa; cursor: pointer;
        }

        /* TIENDA */
        .container { width: 100%; max-width: 500px; padding: 15px; display: flex; flex-direction: column; gap: 20px; }
        .card { background-color: #1e1e1e; border-radius: 16px; padding: 20px; border: 1px solid #333; }
        .app-header { display: flex; gap: 15px; margin-bottom: 20px; }
        .app-icon { width: 72px; height: 72px; background: linear-gradient(135deg, #34a853, #188038); border-radius: 18px; display: flex; justify-content: center; align-items: center; font-size: 38px; }
        .app-info h2 { font-size: 1.1rem; font-weight: 500; }
        .app-info p { color: #01875f; font-weight: 700; font-size: 0.85rem; }
    </style>
</head>
<body>

    <header>
        <div class="logo"><span>ðŸ—¿</span> Coffi's store</div>
        <div id="user-avatar" class="user-avatar" onclick="gestionarPerfil()">?</div>
    </header>

    <div class="container" id="tienda">
        <p style="text-align:center;">Cargando...</p>
    </div>

    <div id="modalCuenta" class="modal-cuenta">
        <div class="modal-content" id="modalContenido">
            </div>
    </div>

    <script>
        const urlRaw = "https://raw.githubusercontent.com/loslocos817yt-star/Minecraft-/main/Link.json?v=" + Date.now();

        window.onload = function() {
            cargarTienda();
            actualizarAvatar();
            
            // Si no hay cuenta, forzar registro al inicio
            if (!localStorage.getItem('coffi_nombre')) {
                mostrarRegistro();
            }
        };

        function actualizarAvatar() {
            const nombre = localStorage.getItem('coffi_nombre');
            const avatar = document.getElementById('user-avatar');
            avatar.innerText = nombre ? nombre.charAt(0).toUpperCase() : "?";
        }

        function gestionarPerfil() {
            const nombre = localStorage.getItem('coffi_nombre');
            if (nombre) {
                mostrarPerfil();
            } else {
                mostrarRegistro();
            }
        }

        function mostrarRegistro() {
            const modal = document.getElementById('modalCuenta');
            const contenido = document.getElementById('modalContenido');
            
            modal.style.display = 'flex';
            contenido.innerHTML = `
                <h2>Crear Cuenta</h2>
                <input type="text" id="regNombre" placeholder="Tu Nombre">
                <input type="password" id="regPass" placeholder="ContraseÃ±a">
                <button class="btn-install" onclick="guardarCuenta()">CREAR CUENTA</button>
            `;
        }

        function mostrarPerfil() {
            const modal = document.getElementById('modalCuenta');
            const contenido = document.getElementById('modalContenido');
            const nombre = localStorage.getItem('coffi_nombre');
            const pass = localStorage.getItem('coffi_pass');

            modal.style.display = 'flex';
            contenido.innerHTML = `
                <span class="btn-cerrar-modal" onclick="cerrarModal()">Ã—</span>
                <h2>Tu Perfil</h2>
                <div class="perfil-info">
                    <p>Nombre de usuario:</p>
                    <span>${nombre}</span>
                    <p style="margin-top:10px;">ContraseÃ±a:</p>
                    <span>${pass}</span>
                </div>
                <button class="btn-install btn-logout" onclick="cerrarSesion()">CERRAR SESIÃ“N</button>
            `;
        }

        function guardarCuenta() {
            const nombre = document.getElementById('regNombre').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            if (nombre && pass) {
                localStorage.setItem('coffi_nombre', nombre);
                localStorage.setItem('coffi_pass', pass);
                cerrarModal();
                actualizarAvatar();
            } else {
                alert("Completa todos los campos");
            }
        }

        function cerrarSesion() {
            if(confirm("Â¿Seguro que quieres salir?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function cerrarModal() {
            document.getElementById('modalCuenta').style.display = 'none';
        }

        async function cargarTienda() {
            const container = document.getElementById('tienda');
            try {
                const response = await fetch(urlRaw);
                const datos = await response.json();
                const listaJuegos = Array.isArray(datos) ? datos : [datos];
                container.innerHTML = "";
                listaJuegos.forEach(juego => {
                    if (juego.link) {
                        const matchID = juego.link.match(/\/d\/([a-zA-Z0-9_-]+)/);
                        if (matchID) {
                            const linkDirecto = `https://drive.google.com/uc?export=download&id=${matchID[1]}`;
                            container.innerHTML += `
                                <div class="card">
                                    <div class="app-header">
                                        <div class="app-icon">ðŸ§Š</div>
                                        <div class="app-info">
                                            <h2>${juego.name}</h2>
                                            <p>Oficial â€¢ Gratis</p>
                                        </div>
                                    </div>
                                    <a href="${linkDirecto}" class="btn-install">Instalar</a>
                                </div>
                            `;
                        }
                    }
                });
            } catch (e) { container.innerHTML = "<p>Error al cargar</p>"; }
        }
    </script>
</body>
</html>
